<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MATLAB Differensiallash va Integrallash: Avtomobil Yoqilg'i Iste'moli Simulyatori</title>

<!-- MathJax (formulalar) -->
<script>
  window.MathJax = { tex: { inlineMath: [['$','$'],['\\(','\\)']] } };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  :root{
    --bg1:#f0f8ff; --bg2:#f8fafc; --ink:#0f172a; --muted:#6b7280;
    --pri:#3b82f6; --pri2:#8b5cf6; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
    --card:#ffffff; --grid:#eef2f7; --frame:#e5e7eb; --accent:#06b6d4;
    --car:#ff6b6b; --fuel:#4ecdc4; --speed:#ffe66d;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Segoe UI',Roboto,'San Francisco',Arial,sans-serif;color:var(--ink);
       background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);line-height:1.6}
  .container{max-width:1400px;margin:0 auto;padding:20px}
  
  .header{background:var(--card);border-radius:20px;padding:30px;box-shadow:0 12px 32px rgba(0,0,0,.15);
          text-align:center;margin-bottom:20px;border:1px solid rgba(255,255,255,.3)}
  .header h1{margin:0 0 12px 0;font-size:32px;font-weight:700;color:#1e293b}
  .header p{margin:0;color:var(--muted);font-size:16px}
  .header .subtitle{margin-top:8px;color:var(--accent);font-weight:500}

  .grid2{display:grid;grid-template-columns:1.2fr 0.8fr;gap:20px}
  .grid3{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}
  @media (max-width:1200px){.grid2{grid-template-columns:1fr}.grid3{grid-template-columns:1fr}}
  
  .card{background:var(--card);border-radius:16px;padding:24px;box-shadow:0 8px 28px rgba(0,0,0,.1);
        margin-bottom:16px;border:1px solid rgba(255,255,255,.2)}
  .card h2{margin:0 0 16px 0;font-size:22px;font-weight:600;color:#1e293b}
  .card h3{margin:0 0 12px 0;font-size:18px;font-weight:600;color:#334155}
  
  .learning-objectives{background:linear-gradient(135deg,#dbeafe 0%,#bfdbfe 100%);
                      border-left:4px solid var(--pri);border-radius:12px;padding:20px}
  .math-model{background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);
                 border-left:4px solid var(--warn);border-radius:12px;padding:20px}
  
  .muted{color:var(--muted)}
  .highlight{background:linear-gradient(120deg,#a7f3d0 0%,#6ee7b7 100%);padding:2px 6px;
            border-radius:6px;font-weight:500}
  .formula-box{background:#1e293b;color:#e2e8f0;padding:16px;border-radius:12px;
               border-left:4px solid var(--accent);margin:12px 0;font-family:monospace}
  
  .parameter-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin:16px 0}
  .param-card{background:var(--bg1);border:2px solid transparent;border-radius:12px;padding:16px;
              transition:all 0.3s ease}
  .param-card:hover{border-color:var(--pri);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}
  .param-card .param-label{font-weight:600;color:#374151;margin-bottom:8px;display:block}
  .param-card .param-desc{color:var(--muted);font-size:14px;margin-bottom:12px}
  .param-card .param-range{font-size:12px;color:var(--muted)}
  
  input[type=range]{width:100%;height:8px;border-radius:8px;background:#e5e7eb;
                   outline:none;-webkit-appearance:none;margin:8px 0}
  input[type=range]::-webkit-slider-thumb{appearance:none;width:20px;height:20px;
                                          border-radius:50%;background:var(--pri);cursor:pointer}
  input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;
                                     background:var(--pri);cursor:pointer;border:none}
  
  input[type=number]{width:100px;padding:8px;border:2px solid var(--frame);border-radius:8px;
                    font-size:14px;transition:border-color 0.3s}
  input[type=number]:focus{border-color:var(--pri);outline:none}
  
  select{padding:8px 12px;border:2px solid var(--frame);border-radius:8px;font-size:14px;
         background:white;transition:border-color 0.3s}
  select:focus{border-color:var(--pri);outline:none}
  
  .btn{background:var(--pri);border:0;color:#fff;padding:10px 16px;border-radius:10px;
       cursor:pointer;font-weight:500;transition:all 0.3s;display:inline-flex;align-items:center;gap:6px}
  .btn:hover{background:#2563eb;transform:translateY(-1px)}
  .btn.secondary{background:#64748b}
  .btn.success{background:var(--ok)}
  .btn.warning{background:var(--warn)}
  .btn.danger{background:var(--bad)}
  .btn.outline{background:transparent;border:2px solid var(--pri);color:var(--pri)}
  .btn.outline:hover{background:var(--pri);color:white}
  
  .btn-group{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}
  
  canvas{width:100%;height:400px;background:#fff;border:2px solid var(--frame);
         border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
  
  .tabs{display:flex;gap:4px;border-bottom:3px solid var(--frame);margin-bottom:20px;background:var(--bg2);
        border-radius:12px 12px 0 0;padding:8px 8px 0 8px}
  .tab{padding:12px 18px;cursor:pointer;border-radius:8px 8px 0 0;font-weight:500;
       transition:all 0.3s;position:relative}
  .tab:hover{background:rgba(59,130,246,.1)}
  .tab.active{background:var(--pri);color:white;border-bottom:3px solid var(--pri)}
  .tab-content{display:none;animation:fadeIn 0.3s ease}
  .tab-content.active{display:block}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  
  .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:16px 0}
  .kpi-card{background:linear-gradient(135deg,var(--bg2) 0%,#f1f5f9 100%);
            border:1px solid var(--frame);border-radius:12px;padding:16px;text-align:center;
            transition:transform 0.3s}
  .kpi-card:hover{transform:scale(1.02)}
  .kpi-value{font-size:24px;font-weight:700;color:var(--pri);display:block}
  .kpi-label{color:var(--muted);font-size:14px;margin-top:4px}
  
  .info-box{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);
            border-radius:12px;padding:16px;margin:12px 0}
  .warning-box{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.3);
               border-radius:12px;padding:16px;margin:12px 0}
  .success-box{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3);
               border-radius:12px;padding:16px;margin:12px 0}
  
  .step-card{background:var(--card);border-left:4px solid var(--pri);border-radius:8px;
             padding:16px;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.1)}
  .step-number{background:var(--pri);color:white;border-radius:50%;width:24px;height:24px;
               display:inline-flex;align-items:center;justify-content:center;font-weight:600;margin-right:8px}
  
  .formula-step{background:var(--bg1);border:1px solid var(--frame);border-radius:8px;
                padding:12px;margin:8px 0;font-family:monospace}
  
  .matlab-code{background:#263238;color:#eeffff;border-radius:12px;padding:20px;
               border-left:4px solid #ff9800;font-size:14px;overflow-x:auto;margin:12px 0}
  .matlab-comment{color:#80cbc4}
  .matlab-keyword{color:#ff9800;font-weight:bold}
  .matlab-string{color:#c3e88d}
  .matlab-number{color:#f78c6c}
  
  .visualization-area{background:var(--bg1);border:2px solid var(--frame);border-radius:12px;
                     padding:20px;margin:16px 0;position:relative}
  .area-fill{opacity:0.3;transition:all 0.5s ease}
  
  pre{margin:0;white-space:pre-wrap;background:#0f172a;color:#e2e8f0;border-radius:12px;
      padding:20px;border-left:4px solid #22d3ee;font-size:14px;overflow-x:auto}
  
  .tooltip{position:relative;cursor:help}
  .tooltip:hover::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;
                       transform:translateX(-50%);background:#1f2937;color:white;padding:8px 12px;
                       border-radius:6px;font-size:12px;white-space:nowrap;z-index:1000}
  
  .progress-bar{background:#e5e7eb;height:6px;border-radius:3px;overflow:hidden;margin:8px 0}
  .progress-fill{background:var(--pri);height:100%;border-radius:3px;transition:width 0.3s}
  
  .car-animation{width:60px;height:30px;background:var(--car);border-radius:15px;
                 position:relative;margin:20px 0;transition:all 1s ease}
  .car-wheels{position:absolute;bottom:-5px;width:8px;height:8px;background:#333;
              border-radius:50%}
  .car-wheels.front{right:8px}
  .car-wheels.rear{left:8px}
  
  @media (max-width:768px){
    .container{padding:12px}
    .header{padding:20px}
    .header h1{font-size:24px}
    .parameter-grid{grid-template-columns:1fr}
    .kpi-grid{grid-template-columns:repeat(2,1fr)}
    canvas{height:300px}
  }
</style>
</head>
<body>
<div class="container">

  <!-- SARLAVHA -->
  <div class="header">
    <h1>A3 - MATLABDA differensiallash va integrallash amallari</h1>
    <p>Avtomobil yoqilg'i iste'moli va yo'l masofasi simulyatori</p>
    <div class="subtitle">Real dunyodagi masala • MATLAB amaliy dasturlash • Vizual matematik</div>
  </div>

  <!-- 1-BOSQICH: DARS MAQSADLARI -->
  <div class="card learning-objectives">
    <h2>🎯 Dars Maqsadlari va O'rganish Natijalari</h2>
    <div class="grid3">
      <div class="step-card">
        <span class="step-number">1</span>
        <strong>Differensiallash tushunchasi:</strong> Tezlik va tezlanishni hisoblash uchun hosilani amaliy qo'llash
      </div>
      <div class="step-card">
        <span class="step-number">2</span>
        <strong>Integrallash ma'nosi:</strong> Yo'l masofasi va yoqilg'i iste'molini hisoblash uchun integraldan foydalanish
      </div>
      <div class="step-card">
        <span class="step-number">3</span>
        <strong>MATLAB amaliy ko'nikmalar:</strong> diff(), integral(), plot() funksiyalarini real masalada qo'llash
      </div>
    </div>
  </div>

  <!-- 2-BOSQICH: MATEMATIK MODEL -->
  <div class="card math-model">
    <h2>📐 Matematik Model: Avtomobil Harakati</h2>
    
    <div class="info-box">
      <strong>🚗 Real hayotiy masala:</strong> Avtomobil turli tezlikda harakat qiladi. Bizga kerak:
      <br>• Har qanday vaqtda avtomobil tezlanishini bilish (differensiallash)
      <br>• Umumiy yo'l masofasini hisoblash (integrallash)
      <br>• Yoqilg'i iste'molini aniqlash (integrallash)
    </div>

    <div class="grid2">
      <div>
        <h3>📊 Berilgan ma'lumotlar</h3>
        <div class="formula-box">
          <strong>Tezlik funksiyasi:</strong><br>
          $v(t) = a + b \sin(ct + d) + e \cos(ft)$
        </div>
        <p class="muted">Bu yerda $t$ - vaqt (soat), $v(t)$ - tezlik (km/soat)</p>
        
        <div class="warning-box">
          <strong>⚠️ Nima uchun shu formula?</strong><br>
          Real avtomobil tezligi doimiy emas - goh tezlashadi, goh sekinlashadi. 
          Sinus va kosinus funksiyalari bu tabiiy o'zgarishlarni yaxshi modellaydi.
        </div>
      </div>
      
      <div>
        <h3>🔧 Matematik operatsiyalar</h3>
        <div class="formula-step">
          <strong>1. Tezlanish (differensiallash):</strong><br>
          $a(t) = \frac{dv}{dt} = bc\cos(ct+d) - ef\sin(ft)$
        </div>
        
        <div class="formula-step">
          <strong>2. Masofa (integrallash):</strong><br>
          $s(t) = \int_0^t v(\tau) d\tau$
        </div>
        
        <div class="formula-step">
          <strong>3. Yoqilg'i (integrallash):</strong><br>
          $F(t) = \int_0^t k \cdot v(\tau)^2 d\tau$
        </div>
        
        <div class="success-box">
          <strong>💡 Muhim:</strong> MATLAB bu hisob-kitoblarni avtomatik bajaradi!
        </div>
      </div>
    </div>
  </div>

  <!-- 3-6 BOSQICH: INTERAKTIV SIMULYATOR -->
  <div class="card">
    <h2>💻 Interaktiv MATLAB Simulyatori</h2>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="sim">📊 Simulyatsiya</div>
      <div class="tab" data-tab="theory">📚 Nazariya</div>
      <div class="tab" data-tab="matlab">💻 MATLAB Kodlari</div>
      <div class="tab" data-tab="practice">🔬 Amaliy Mashqlar</div>
      <div class="tab" data-tab="tasks">📝 Topshiriqlar</div>
    </div>

    <!-- SIMULYATSIYA TABI -->
    <div class="tab-content active" id="tab-sim">
      <div class="grid2">
        <div>
          <h3>⚙️ Avtomobil parametrlarini sozlash</h3>
          
          <div class="parameter-grid">
            <div class="param-card">
              <label class="param-label">🏁 Bazaviy tezlik (a)</label>
              <div class="param-desc">Avtomobilning o'rtacha tezligi</div>
              <input id="a" type="range" min="20" max="80" step="1" value="50">
              <span id="va" class="param-range"></span>
            </div>
            
            <div class="param-card">
              <label class="param-label">📈 Tezlik amplitudasi (b)</label>
              <div class="param-desc">Tezlik qanchalik o'zgarishi mumkin</div>
              <input id="b" type="range" min="5" max="30" step="1" value="15">
              <span id="vb" class="param-range"></span>
            </div>
            
            <div class="param-card">
              <label class="param-label">🔄 Asosiy chastota (c)</label>
              <div class="param-desc">Tezlik o'zgarish tezligi</div>
              <input id="c" type="range" min="0.5" max="3.0" step="0.1" value="1.5">
              <span id="vc" class="param-range"></span>
            </div>
            
            <div class="param-card">
              <label class="param-label">↔️ Fazalar siljishi (d)</label>
              <div class="param-desc">Boshlang'ich holat</div>
              <input id="d" type="range" min="0" max="6.28" step="0.1" value="0">
              <span id="vd" class="param-range"></span>
            </div>
            
            <div class="param-card">
              <label class="param-label">🌊 Qo'shimcha amplituda (e)</label>
              <div class="param-desc">Ikkinchi tebranish kuchi</div>
              <input id="e" type="range" min="0" max="20" step="1" value="10">
              <span id="ve" class="param-range"></span>
            </div>
            
            <div class="param-card">
              <label class="param-label">⚡ Qo'shimcha chastota (f)</label>
              <div class="param-desc">Ikkinchi tebranish tezligi</div>
              <input id="f" type="range" min="0.2" max="2.0" step="0.1" value="0.8">
              <span id="vf" class="param-range"></span>
            </div>
          </div>

          <div class="parameter-grid" style="grid-template-columns:repeat(3,1fr)">
            <div class="param-card">
              <label class="param-label">⛽ Yoqilg'i koeff. (k)</label>
              <div class="param-desc">Yoqilg'i iste'moli omili</div>
              <input id="k" type="range" min="0.001" max="0.01" step="0.001" value="0.005">
              <span id="vk" class="param-range"></span>
            </div>
            
            <div class="param-card">
              <label class="param-label">⏱️ Vaqt (soat)</label>
              <input id="tmax" type="number" value="4" min="1" max="12" step="0.5">
              <div class="param-range">soat</div>
            </div>
            
            <div class="param-card">
              <label class="param-label">🎯 Aniqlik</label>
              <select id="precision">
                <option value="100">Oddiy (100 nuqta)</option>
                <option value="500" selected>Yaxshi (500 nuqta)</option>
                <option value="1000">Mukammal (1000 nuqta)</option>
              </select>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn" id="calculate">🧮 Hisoblash</button>
            <button class="btn outline" id="reset">🔄 Qayta tiklash</button>
            <button class="btn success" id="animate">🎬 Animatsiya</button>
          </div>

          <div class="btn-group">
            <button class="btn secondary" id="exportData">📊 Ma'lumotlarni eksport</button>
            <button class="btn secondary" id="exportMatlab">💻 MATLAB skriptni saqlash</button>
          </div>

          <!-- NATIJALAR -->
          <h3>📊 Hisoblash Natijalari</h3>
          <div class="kpi-grid">
            <div class="kpi-card">
              <span class="kpi-value" id="totalDistance">--</span>
              <div class="kpi-label">Umumiy masofa (km)</div>
            </div>
            <div class="kpi-card">
              <span class="kpi-value" id="totalFuel">--</span>
              <div class="kpi-label">Yoqilg'i sarfi (L)</div>
            </div>
            <div class="kpi-card">
              <span class="kpi-value" id="avgSpeed">--</span>
              <div class="kpi-label">O'rtacha tezlik (km/h)</div>
            </div>
            <div class="kpi-card">
              <span class="kpi-value" id="maxSpeed">--</span>
              <div class="kpi-label">Maksimal tezlik (km/h)</div>
            </div>
            <div class="kpi-card">
              <span class="kpi-value" id="maxAccel">--</span>
              <div class="kpi-label">Maksimal tezlanish (km/h²)</div>
            </div>
            <div class="kpi-card">
              <span class="kpi-value" id="efficiency">--</span>
              <div class="kpi-label">Samaradorlik (km/L)</div>
            </div>
          </div>

          <!-- ANIMATSIYA HUDUDI -->
          <div class="visualization-area">
            <h4>🚗 Avtomobil harakati animatsiyasi</h4>
            <div style="position:relative;height:80px;background:linear-gradient(to right,#e5e7eb 0%,#d1d5db 100%);border-radius:8px;overflow:hidden">
              <div id="carAnimation" class="car-animation">
                <div class="car-wheels front"></div>
                <div class="car-wheels rear"></div>
              </div>
              <div style="position:absolute;bottom:10px;left:10px;font-size:12px;color:#6b7280">Yo'l</div>
              <div style="position:absolute;bottom:10px;right:10px;font-size:12px;color:#6b7280" id="currentTime">t = 0.00h</div>
            </div>
          </div>
        </div>

        <div>
          <h3>📈 Grafiklar va Vizualizatsiya</h3>
          
          <div class="info-box">
            <strong>📖 Grafiklarni o'qish:</strong><br>
            • <span style="color:var(--car)">🔴 Qizil</span> - Tezlik v(t)<br>
            • <span style="color:var(--pri)">🔵 Ko'k</span> - Tezlanish a(t)<br>
            • <span style="color:var(--ok)">🟢 Yashil</span> - Masofa s(t)<br>
            • <span style="color:var(--fuel)">🟦 Moviy</span> - Yoqilg'i F(t)<br>
            • 🔶 Sariq hudud - Integral (maydoni)
          </div>
          
          <h4>Tezlik va Tezlanish</h4>
          <canvas id="velocityChart" width="900" height="300"></canvas>
          
          <h4>Masofa va Yoqilg'i Iste'moli</h4>
          <canvas id="distanceChart" width="900" height="300"></canvas>
          
          <h4>Integral Vizualizatsiyasi</h4>
          <canvas id="integralChart" width="900" height="300"></canvas>
        </div>
      </div>
    </div>

    <!-- NAZARIYA TABI -->
    <div class="tab-content" id="tab-theory">
      <h3>📚 Differensiallash va Integrallash Nazariyasi</h3>
      
      <div class="grid2">
        <div>
          <h4>📐 Differensiallash (Hosila)</h4>
          <div class="step-card">
            <span class="step-number">📍</span>
            <strong>Geometrik ma'no:</strong> Egri chiziqning ixtiyoriy nuqtasidagi urinma burchagi
          </div>
          
          <div class="step-card">
            <span class="step-number">🏃</span>
            <strong>Fizik ma'no:</strong> Tezlik - bu masofaning vaqt bo'yicha hosilasi: $v = \frac{ds}{dt}$
          </div>
          
          <div class="step-card">
            <span class="step-number">⚡</span>
            <strong>Tezlanish:</strong> Tezlikning vaqt bo'yicha hosilasi: $a = \frac{dv}{dt} = \frac{d^2s}{dt^2}$
          </div>
          
          <div class="formula-box">
            <strong>MATLAB da:</strong><br>
            syms t<br>
            v = 50 + 15*sin(1.5*t);<br>
            a = diff(v, t);  % hosila
          </div>
        </div>
        
        <div>
          <h4>∫ Integrallash</h4>
          <div class="step-card">
            <span class="step-number">📏</span>
            <strong>Geometrik ma'no:</strong> Egri chiziq ostidagi maydon
          </div>
          
          <div class="step-card">
            <span class="step-number">🛣️</span>
            <strong>Fizik ma'no:</strong> Masofa - bu tezlikning vaqt bo'yicha integrali: $s = \int v(t) dt$
          </div>
          
          <div class="step-card">
            <span class="step-number">⛽</span>
            <strong>Yoqilg'i:</strong> Iste'mol tezligining vaqt bo'yicha integrali
          </div>
          
          <div class="formula-box">
            <strong>MATLAB da:</strong><br>
            distance = integral(@(t) velocity_func(t), 0, T);<br>
            % yoki simbolik:<br>
            s = int(v, t, 0, T);
          </div>
        </div>
      </div>

      <div class="warning-box">
        <h4>🤔 Nega bu muhim?</h4>
        <p>Real hayotda ko'p masalalar differensiallash va integrallash yordamida yechiladi:</p>
        <p>• <strong>Muhandislik:</strong> Inshootlar mustahkamligi, signal qayta ishlash</p>
        <p>• <strong>Fizika:</strong> Harakat, energiya, maydonlar</p>
        <p>• <strong>Iqtisod:</strong> Foyda, xarajat optimallashtirish</p>
        <p>• <strong>Biologia:</strong> Populyatsiya o'sishi, farmakokinetika</p>
      </div>
    </div>

    <!-- MATLAB KODLARI TABI -->
    <div class="tab-content" id="tab-matlab">
      <div class="grid2">
        <div>
          <h3>💻 MATLAB Asosiy Kodlari</h3>
          
          <h4>1. 📊 Simbolik hisoblash</h4>
          <div class="matlab-code">
<span class="matlab-comment">% Simbolik o'zgaruvchi yaratish</span>
<span class="matlab-keyword">syms</span> t
<span class="matlab-comment">% Tezlik funksiyasini aniqlash</span>
v = <span class="matlab-number">50</span> + <span class="matlab-number">15</span>*sin(<span class="matlab-number">1.5</span>*t) + <span class="matlab-number">10</span>*cos(<span class="matlab-number">0.8</span>*t);

<span class="matlab-comment">% Tezlanishni hisoblash (hosila)</span>
a = diff(v, t);

<span class="matlab-comment">% Masofani hisoblash (integral)</span>
s = int(v, t, <span class="matlab-number">0</span>, <span class="matlab-number">4</span>);

<span class="matlab-comment">% Natijalarni ko'rsatish</span>
disp([<span class="matlab-string">'Tezlanish: '</span>, char(a)]);
disp([<span class="matlab-string">'Masofa: '</span>, double(s)]);
          </div>
          
          <h4>2. 📈 Grafik chizish</h4>
          <div class="matlab-code">
<span class="matlab-comment">% Vaqt vektorini yaratish</span>
t_vals = linspace(<span class="matlab-number">0</span>, <span class="matlab-number">4</span>, <span class="matlab-number">500</span>);

<span class="matlab-comment">% Funksiyalarni hisoblash</span>
v_vals = double(subs(v, t, t_vals));
a_vals = double(subs(a, t, t_vals));

<span class="matlab-comment">% Grafiklarni chizish</span>
figure;
subplot(<span class="matlab-number">2</span>,<span class="matlab-number">1</span>,<span class="matlab-number">1</span>);
plot(t_vals, v_vals, <span class="matlab-string">'r-'</span>, <span class="matlab-string">'LineWidth'</span>, <span class="matlab-number">2</span>);
title(<span class="matlab-string">'Tezlik vaqtga bog''liqligi'</span>);
xlabel(<span class="matlab-string">'Vaqt (soat)'</span>); ylabel(<span class="matlab-string">'Tezlik (km/h)'</span>);

subplot(<span class="matlab-number">2</span>,<span class="matlab-number">1</span>,<span class="matlab-number">2</span>);
plot(t_vals, a_vals, <span class="matlab-string">'b-'</span>, <span class="matlab-string">'LineWidth'</span>, <span class="matlab-number">2</span>);
title(<span class="matlab-string">'Tezlanish vaqtga bog''liqligi'</span>);
xlabel(<span class="matlab-string">'Vaqt (soat)'</span>); ylabel(<span class="matlab-string">'Tezlanish (km/h²)'</span>);
          </div>
        </div>
        
        <div>
          <h4>3. 🔢 Raqamli hisoblash</h4>
          <div class="matlab-code">
<span class="matlab-comment">% Raqamli integration</span>
velocity_func = @(t) <span class="matlab-number">50</span> + <span class="matlab-number">15</span>*sin(<span class="matlab-number">1.5</span>*t) + <span class="matlab-number">10</span>*cos(<span class="matlab-number">0.8</span>*t);

<span class="matlab-comment">% Masofani hisoblash</span>
distance = integral(velocity_func, <span class="matlab-number">0</span>, <span class="matlab-number">4</span>);

<span class="matlab-comment">% Yoqilg'i iste'molini hisoblash</span>
fuel_func = @(t) <span class="matlab-number">0.005</span> * velocity_func(t).<span class="matlab-keyword">^</span><span class="matlab-number">2</span>;
total_fuel = integral(fuel_func, <span class="matlab-number">0</span>, <span class="matlab-number">4</span>);

fprintf(<span class="matlab-string">'Umumiy masofa: %.2f km\n'</span>, distance);
fprintf(<span class="matlab-string">'Yoqilg''i sarfi: %.2f L\n'</span>, total_fuel);
          </div>
          
          <h4>4. 🎨 Maydonni bo'yash</h4>
          <div class="matlab-code">
<span class="matlab-comment">% Integral ostidagi maydonni ko'rsatish</span>
figure;
plot(t_vals, v_vals, <span class="matlab-string">'r-'</span>, <span class="matlab-string">'LineWidth'</span>, <span class="matlab-number">3</span>);
hold on;

<span class="matlab-comment">% Maydonni bo'yash</span>
fill([t_vals, fliplr(t_vals)], [v_vals, zeros(size(v_vals))], ...
     <span class="matlab-string">'y'</span>, <span class="matlab-string">'FaceAlpha'</span>, <span class="matlab-number">0.3</span>, <span class="matlab-string">'EdgeColor'</span>, <span class="matlab-string">'none'</span>);

title(<span class="matlab-string">'Tezlik grafigi va integral (sariq maydon)'</span>);
xlabel(<span class="matlab-string">'Vaqt (soat)'</span>); ylabel(<span class="matlab-string">'Tezlik (km/h)'</span>);
legend(<span class="matlab-string">'Tezlik'</span>, <span class="matlab-string">'Integral (masofa)'</span>);
grid on;
          </div>
          
          <div class="success-box">
            <strong>💡 Maslahat:</strong> Bu kodlarni MATLAB da bosqichma-bosqich ishga tushiring. 
            Har bir qadamda nimalar sodir bo'layotganini kuzating!
          </div>
        </div>
      </div>

      <div class="info-box">
        <h4>📥 Joriy parametrlar uchun MATLAB kodi:</h4>
        <pre id="currentMatlabCode">Kod yuklanmoqda...</pre>
        <button class="btn" id="copyMatlabCode">📋 Kodni nusxalash</button>
      </div>
    </div>

    <!-- AMALIY MASHQLAR TABI -->
    <div class="tab-content" id="tab-practice">
      <h3>🔬 Amaliy Mashqlar va Eksperimentlar</h3>
      
      <div class="grid2">
        <div>
          <h4>🧪 Mashq 1: Parametrlar ta'siri</h4>
          <div class="step-card">
            <span class="step-number">1</span>
            Amplituda (b) ni 5 ga o'zgartiring. Tezlanish grafigi qanday o'zgaradi?
          </div>
          
          <div class="step-card">
            <span class="step-number">2</span>
            Chastota (c) ni 3.0 ga oshiring. Avtomobil harakati qanday bo'ladi?
          </div>
          
          <div class="step-card">
            <span class="step-number">3</span>
            Bazaviy tezlik (a) ni 30 km/h ga kamaytirganda yoqilg'i sarfi qanday o'zgaradi?
          </div>
          
          <h4>🧪 Mashq 2: Yoqilg'i samaradorligi</h4>
          <div class="step-card">
            <span class="step-number">1</span>
            Yoqilg'i koeffitsienti (k) ni 0.001 va 0.01 qilib taqqoslang
          </div>
          
          <div class="step-card">
            <span class="step-number">2</span>
            Qaysi tezlik rejimi eng tejamkor? (km/L ko'rsatkichini kuzating)
          </div>
        </div>
        
        <div>
          <h4>🧪 Mashq 3: Matematik tahlil</h4>
          <div class="step-card">
            <span class="step-number">1</span>
            Tezlanish nolga teng bo'ladigan nuqtalarni toping (grafik orqali)
          </div>
          
          <div class="step-card">
            <span class="step-number">2</span>
            Minimal va maksimal tezlik nuqtalarini aniqlang
          </div>
          
          <div class="step-card">
            <span class="step-number">3</span>
            Integral qiymatlari aniq hisoblanganmi tekshiring (maydon orqali)
          </div>
          
          <h4>🧪 Mashq 4: Real masala</h4>
          <div class="step-card">
            <span class="step-number">1</span>
            Shahar ichida haydash: a=40, b=10, c=2.0
          </div>
          
          <div class="step-card">
            <span class="step-number">2</span>
            Avtoyol haydash: a=80, b=5, c=0.5
          </div>
          
          <div class="step-card">
            <span class="step-number">3</span>
            Qaysi holat yoqilg'ini ko'proq sarflaydi?
          </div>
        </div>
      </div>

      <div class="warning-box">
        <strong>🎯 Maqsad:</strong> Bu mashqlar orqali siz matematik tushunchalarning amaliy qo'llanishini 
        chuqur tushunasiz va MATLAB dasturlash ko'nikmalarini rivojlantirasiz.
      </div>
    </div>

    <!-- TOPSHIRIQLAR TABI -->
    <div class="tab-content" id="tab-tasks">
      <h3>📝 Nazоrat Savollari va Topshiriqlar</h3>
      
      <div class="grid2">
        <div>
          <h4>❓ Nazariy savollar</h4>
          
          <div class="step-card">
            <span class="step-number">1</span>
            <strong>Hosila tushunchasi:</strong> Tezlik funksiyasining hosilasi nimani bildiradi? 
            Real hayotda bu qanday holatlarda foydali?
          </div>
          
          <div class="step-card">
            <span class="step-number">2</span>
            <strong>Integral ma'nosi:</strong> Tezlik grafigi ostidagi maydon nima uchun masofani beradi? 
            Matematik jihatdan buni qanday tushuntirish mumkin?
          </div>
          
          <div class="step-card">
            <span class="step-number">3</span>
            <strong>MATLAB afzalliklari:</strong> Nega qo'lda hisoblash o'rniga MATLAB ishlatamiz? 
            Qanday afzalliklar bor?
          </div>
          
          <div class="step-card">
            <span class="step-number">4</span>
            <strong>Aniqlik masalasi:</strong> Raqamli integrallash qanchalik aniq? 
            Aniqlikni oshirish uchun nima qilish mumkin?
          </div>
        </div>
        
        <div>
          <h4>🔬 Amaliy topshiriqlar</h4>
          
          <div class="step-card">
            <span class="step-number">A</span>
            <strong>Optimal rejim:</strong> Yoqilg'i samaradorligi eng yuqori bo'ladigan parametrlar 
            kombinatsiyasini toping. (Maqsad: maksimal km/L)
          </div>
          
          <div class="step-card">
            <span class="step-number">B</span>
            <strong>Tezlanish tahlili:</strong> Tezlanish eng katta bo'ladigan vaqt oralig'ini aniqlang. 
            Bu vaqtda avtomobil harakati qanday?
          </div>
          
          <div class="step-card">
            <span class="step-number">C</span>
            <strong>Matematik model:</strong> Avtomobil 200 km yo'lni bosib o'tishi uchun 
            parametrlarni qanday sozlash kerak?
          </div>
          
          <div class="step-card">
            <span class="step-number">D</span>
            <strong>MATLAB loyiha:</strong> O'zingizning tezlik funksiyangizni yarating va 
            uni tahlil qiling. Natijalarni taqdim eting.
          </div>
        </div>
      </div>

      <div class="success-box">
        <h4>🏆 Baholash mezonlari</h4>
        <p><strong>A'lo (5):</strong> Barcha savollarni to'g'ri javoblash + amaliy loyiha yaratish</p>
        <p><strong>Yaxshi (4):</strong> Ko'pchilik savollarni javoblash + MATLAB kodlarini tushunish</p>
        <p><strong>Qoniqarli (3):</strong> Asosiy tushunchalarni bilish + oddiy hisob-kitoblar</p>
      </div>
    </div>
  </div>

</div>

<!-- ===== JAVASCRIPT: SIMULYATOR LOGIKASI ===== -->
<script>
// ========== UTILITY FUNCTIONS ==========
function $(id) { return document.getElementById(id); }

// Parameter label updates
function updateLabels() {
  const params = [
    {id: 'a', output: 'va', suffix: ' km/h', decimals: 0},
    {id: 'b', output: 'vb', suffix: ' km/h', decimals: 0},
    {id: 'c', output: 'vc', suffix: ' rad/h', decimals: 1},
    {id: 'd', output: 'vd', suffix: ' rad', decimals: 1},
    {id: 'e', output: 've', suffix: ' km/h', decimals: 0},
    {id: 'f', output: 'vf', suffix: ' rad/h', decimals: 1},
    {id: 'k', output: 'vk', suffix: ' L·h/km²', decimals: 3}
  ];
  
  params.forEach(({id, output, suffix, decimals}) => {
    const element = $(id);
    const outputElement = $(output);
    if (element && outputElement) {
      outputElement.textContent = parseFloat(element.value).toFixed(decimals) + suffix;
    }
  });
}

// File download functions
function downloadFile(content, filename, mimeType = 'text/plain') {
  const blob = new Blob([content], {type: mimeType + ';charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
}

// ========== MATHEMATICAL FUNCTIONS ==========
function velocityFunction(t, params) {
  const {a, b, c, d, e, f} = params;
  return a + b * Math.sin(c * t + d) + e * Math.cos(f * t);
}

function accelerationFunction(t, params) {
  const {b, c, d, e, f} = params;
  return b * c * Math.cos(c * t + d) - e * f * Math.sin(f * t);
}

function fuelConsumptionRate(t, params) {
  const velocity = velocityFunction(t, params);
  return params.k * velocity * velocity;
}

// Numerical integration using Simpson's rule
function simpsonsRule(func, a, b, n, params) {
  if (n % 2 !== 0) n++; // Ensure even number of intervals
  
  const h = (b - a) / n;
  let sum = func(a, params) + func(b, params);
  
  for (let i = 1; i < n; i++) {
    const x = a + i * h;
    sum += (i % 2 === 0 ? 2 : 4) * func(x, params);
  }
  
  return (h / 3) * sum;
}

// ========== SIMULATION ==========
function runCalculation() {
  const params = {
    a: parseFloat($('a').value),
    b: parseFloat($('b').value),
    c: parseFloat($('c').value),
    d: parseFloat($('d').value),
    e: parseFloat($('e').value),
    f: parseFloat($('f').value),
    k: parseFloat($('k').value),
    tmax: parseFloat($('tmax').value)
  };

  const precision = parseInt($('precision').value);
  const dt = params.tmax / precision;
  
  // Generate time array
  const timeArray = [];
  const velocityArray = [];
  const accelerationArray = [];
  const distanceArray = [];
  const fuelArray = [];
  
  let cumulativeDistance = 0;
  let cumulativeFuel = 0;
  
  for (let i = 0; i <= precision; i++) {
    const t = i * dt;
    const v = velocityFunction(t, params);
    const a = accelerationFunction(t, params);
    
    timeArray.push(t);
    velocityArray.push(v);
    accelerationArray.push(a);
    
    // Numerical integration for distance and fuel
    if (i > 0) {
      const prevT = (i - 1) * dt;
      cumulativeDistance += simpsonsRule(velocityFunction, prevT, t, 10, params);
      cumulativeFuel += simpsonsRule(fuelConsumptionRate, prevT, t, 10, params);
    }
    
    distanceArray.push(cumulativeDistance);
    fuelArray.push(cumulativeFuel);
  }
  
  // Calculate KPIs
  const totalDistance = cumulativeDistance;
  const totalFuel = cumulativeFuel;
  const avgSpeed = totalDistance / params.tmax;
  const maxSpeed = Math.max(...velocityArray);
  const maxAccel = Math.max(...accelerationArray.map(Math.abs));
  const efficiency = totalFuel > 0 ? totalDistance / totalFuel : 0;
  
  return {
    timeArray,
    velocityArray,
    accelerationArray,
    distanceArray,
    fuelArray,
    params,
    kpis: {
      totalDistance,
      totalFuel,
      avgSpeed,
      maxSpeed,
      maxAccel,
      efficiency
    }
  };
}

// ========== PLOTTING ==========
function clearCanvas(ctx, canvas) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Draw light grid
  ctx.strokeStyle = '#f8fafc';
  ctx.lineWidth = 1;
  for (let x = 0; x <= canvas.width; x += 40) {
    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x, canvas.height);
    ctx.stroke();
  }
  for (let y = 0; y <= canvas.height; y += 25) {
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.stroke();
  }
  
  // Border
  ctx.strokeStyle = '#e2e8f0';
  ctx.lineWidth = 2;
  ctx.strokeRect(0, 0, canvas.width, canvas.height);
}

function getArrayBounds(arr1, arr2 = null) {
  let allValues = [...arr1];
  if (arr2) allValues = allValues.concat(arr2);
  
  const min = Math.min(...allValues);
  const max = Math.max(...allValues);
  const range = max - min;
  const padding = range * 0.1;
  
  return {
    min: min - padding,
    max: max + padding
  };
}

function mapToCanvas(x, y, xBounds, yBounds, canvas) {
  const margin = 40;
  const plotWidth = canvas.width - 2 * margin;
  const plotHeight = canvas.height - 2 * margin;
  
  const canvasX = margin + (x - xBounds.min) / (xBounds.max - xBounds.min) * plotWidth;
  const canvasY = canvas.height - margin - (y - yBounds.min) / (yBounds.max - yBounds.min) * plotHeight;
  
  return [canvasX, canvasY];
}

function plotLine(ctx, canvas, xData, yData, color, lineWidth = 2) {
  if (xData.length < 2) return;
  
  const xBounds = getArrayBounds(xData);
  const yBounds = getArrayBounds(yData);
  
  ctx.strokeStyle = color;
  ctx.lineWidth = lineWidth;
  ctx.beginPath();
  
  const [startX, startY] = mapToCanvas(xData[0], yData[0], xBounds, yBounds, canvas);
  ctx.moveTo(startX, startY);
  
  for (let i = 1; i < xData.length; i++) {
    const [x, y] = mapToCanvas(xData[i], yData[i], xBounds, yBounds, canvas);
    ctx.lineTo(x, y);
  }
  
  ctx.stroke();
  
  return {xBounds, yBounds};
}

function plotFillArea(ctx, canvas, xData, yData, color, alpha = 0.3) {
  if (xData.length < 2) return;
  
  const xBounds = getArrayBounds(xData);
  const yBounds = getArrayBounds(yData);
  
  // Ensure yBounds includes zero
  if (yBounds.max > 0 && yBounds.min > 0) yBounds.min = 0;
  if (yBounds.min < 0 && yBounds.max < 0) yBounds.max = 0;
  
  ctx.globalAlpha = alpha;
  ctx.fillStyle = color;
  ctx.beginPath();
  
  // Start from bottom-left
  const [startX, startY] = mapToCanvas(xData[0], 0, xBounds, yBounds, canvas);
  ctx.moveTo(startX, startY);
  
  // Draw the curve
  for (let i = 0; i < xData.length; i++) {
    const [x, y] = mapToCanvas(xData[i], yData[i], xBounds, yBounds, canvas);
    ctx.lineTo(x, y);
  }
  
  // Close the area to bottom
  const [endX, endY] = mapToCanvas(xData[xData.length - 1], 0, xBounds, yBounds, canvas);
  ctx.lineTo(endX, endY);
  ctx.closePath();
  ctx.fill();
  
  ctx.globalAlpha = 1.0;
  
  return {xBounds, yBounds};
}

// ========== CHART UPDATES ==========
function updateCharts(result) {
  const {timeArray, velocityArray, accelerationArray, distanceArray, fuelArray} = result;
  
  // Velocity and Acceleration Chart
  const velocityCanvas = $('velocityChart');
  const velocityCtx = velocityCanvas.getContext('2d');
  clearCanvas(velocityCtx, velocityCanvas);
  
  plotLine(velocityCtx, velocityCanvas, timeArray, velocityArray, '#ff6b6b', 3);
  plotLine(velocityCtx, velocityCanvas, timeArray, accelerationArray, '#3b82f6', 2);
  
  // Distance and Fuel Chart
  const distanceCanvas = $('distanceChart');
  const distanceCtx = distanceCanvas.getContext('2d');
  clearCanvas(distanceCtx, distanceCanvas);
  
  plotLine(distanceCtx, distanceCanvas, timeArray, distanceArray, '#10b981', 3);
  plotLine(distanceCtx, distanceCanvas, timeArray, fuelArray, '#4ecdc4', 2);
  
  // Integral Visualization Chart
  const integralCanvas = $('integralChart');
  const integralCtx = integralCanvas.getContext('2d');
  clearCanvas(integralCtx, integralCanvas);
  
  plotFillArea(integralCtx, integralCanvas, timeArray, velocityArray, '#ffe66d', 0.4);
  plotLine(integralCtx, integralCanvas, timeArray, velocityArray, '#ff6b6b', 3);
}

// ========== KPI UPDATES ==========
function updateKPIs(kpis) {
  $('totalDistance').textContent = kpis.totalDistance.toFixed(1);
  $('totalFuel').textContent = kpis.totalFuel.toFixed(2);
  $('avgSpeed').textContent = kpis.avgSpeed.toFixed(1);
  $('maxSpeed').textContent = kpis.maxSpeed.toFixed(1);
  $('maxAccel').textContent = kpis.maxAccel.toFixed(1);
  $('efficiency').textContent = kpis.efficiency.toFixed(2);
}

// ========== MATLAB CODE GENERATION ==========
function generateMatlabCode(params) {
  return `% MATLAB Kod: Avtomobil Yoqilg'i Iste'moli Tahlili
% Parametrlar (joriy qiymatlar)
a = ${params.a};    % Bazaviy tezlik (km/h)
b = ${params.b};    % Amplituda (km/h)
c = ${params.c};    % Asosiy chastota (rad/h)
d = ${params.d};    % Faza siljishi (rad)
e = ${params.e};    % Qo'shimcha amplituda (km/h)
f = ${params.f};    % Qo'shimcha chastota (rad/h)
k = ${params.k};    % Yoqilg'i koeffitsienti
T = ${params.tmax}; % Umumiy vaqt (soat)

% Simbolik hisoblash
syms t
v_sym = a + b*sin(c*t + d) + e*cos(f*t);
a_sym = diff(v_sym, t);

% Raqamli hisoblash
t_vals = linspace(0, T, 500);
v_vals = double(subs(v_sym, t, t_vals));
a_vals = double(subs(a_sym, t, t_vals));

% Integral hisoblash
distance = double(int(v_sym, t, 0, T));
fuel_func = k * v_sym^2;
total_fuel = double(int(fuel_func, t, 0, T));

% Natijalarni chiqarish
fprintf('Umumiy masofa: %.2f km\\n', distance);
fprintf('Yoqilg''i sarfi: %.2f L\\n', total_fuel);
fprintf('O''rtacha tezlik: %.2f km/h\\n', distance/T);
fprintf('Samaradorlik: %.2f km/L\\n', distance/total_fuel);

% Grafiklar
figure;
subplot(2,2,1);
plot(t_vals, v_vals, 'r-', 'LineWidth', 2);
title('Tezlik v(t)'); xlabel('Vaqt (h)'); ylabel('Tezlik (km/h)');
grid on;

subplot(2,2,2);
plot(t_vals, a_vals, 'b-', 'LineWidth', 2);
title('Tezlanish a(t)'); xlabel('Vaqt (h)'); ylabel('Tezlanish (km/h²)');
grid on;

subplot(2,2,3);
plot(t_vals, v_vals, 'r-', 'LineWidth', 2);
hold on;
fill([t_vals, fliplr(t_vals)], [v_vals, zeros(size(v_vals))], ...
     'y', 'FaceAlpha', 0.3, 'EdgeColor', 'none');
title('Integral (masofa = sariq maydon)');
xlabel('Vaqt (h)'); ylabel('Tezlik (km/h)');
legend('Tezlik', 'Integral', 'Location', 'best');
grid on;

subplot(2,2,4);
% Kumulyativ masofa va yoqilg'i
s_vals = cumtrapz(t_vals, v_vals);
f_vals = cumtrapz(t_vals, k * v_vals.^2);
plot(t_vals, s_vals, 'g-', 'LineWidth', 2);
hold on;
plot(t_vals, f_vals, 'c-', 'LineWidth', 2);
title('Kumulyativ qiymatlar');
xlabel('Vaqt (h)'); ylabel('Qiymat');
legend('Masofa (km)', 'Yoqilg''i (L)', 'Location', 'best');
grid on;`;
}

// ========== ANIMATION ==========
let animationRunning = false;
let animationFrame;

function startAnimation(result) {
  if (animationRunning) return;
  
  animationRunning = true;
  const carElement = $('carAnimation');
  const timeElement = $('currentTime');
  const {timeArray, velocityArray, params} = result;
  
  let currentIndex = 0;
  const animationSpeed = 50; // milliseconds per frame
  
  function animate() {
    if (currentIndex >= timeArray.length) {
      currentIndex = 0; // Loop animation
    }
    
    const currentTime = timeArray[currentIndex];
    const currentVelocity = velocityArray[currentIndex];
    
    // Update car position (0 to 90% of container width)
    const progress = currentIndex / (timeArray.length - 1);
    const position = progress * 90; // percentage
    carElement.style.left = position + '%';
    
    // Update time display
    timeElement.textContent = `t = ${currentTime.toFixed(2)}h, v = ${currentVelocity.toFixed(1)} km/h`;
    
    // Car color based on speed
    const normalizedSpeed = (currentVelocity - 20) / 80; // 20-100 km/h range
    const hue = Math.max(0, Math.min(120, 120 * (1 - normalizedSpeed))); // Red to green
    carElement.style.background = `hsl(${hue}, 70%, 60%)`;
    
    currentIndex++;
    
    if (animationRunning) {
      animationFrame = setTimeout(animate, animationSpeed);
    }
  }
  
  animate();
}

function stopAnimation() {
  animationRunning = false;
  if (animationFrame) {
    clearTimeout(animationFrame);
  }
}

// ========== MAIN EXECUTION ==========
let lastResult = null;

function runMain() {
  updateLabels();
  const result = runCalculation();
  lastResult = result;
  
  updateCharts(result);
  updateKPIs(result.kpis);
  
  // Update MATLAB code
  $('currentMatlabCode').textContent = generateMatlabCode(result.params);
}

function resetParameters() {
  $('a').value = 50;
  $('b').value = 15;
  $('c').value = 1.5;
  $('d').value = 0;
  $('e').value = 10;
  $('f').value = 0.8;
  $('k').value = 0.005;
  $('tmax').value = 4;
  $('precision').value = 500;
  
  stopAnimation();
  runMain();
}

// ========== EVENT LISTENERS ==========
$('calculate').addEventListener('click', runMain);
$('reset').addEventListener('click', resetParameters);

$('animate').addEventListener('click', () => {
  if (lastResult) {
    if (animationRunning) {
      stopAnimation();
      $('animate').textContent = '🎬 Animatsiya';
    } else {
      startAnimation(lastResult);
      $('animate').textContent = '⏹️ To\'xtatish';
    }
  }
});

$('exportData').addEventListener('click', () => {
  if (lastResult) {
    const {timeArray, velocityArray, accelerationArray, distanceArray, fuelArray} = lastResult;
    let csv = 'Vaqt(h),Tezlik(km/h),Tezlanish(km/h²),Masofa(km),Yoqilgi(L)\n';
    
    for (let i = 0; i < timeArray.length; i++) {
      csv += `${timeArray[i].toFixed(3)},${velocityArray[i].toFixed(2)},${accelerationArray[i].toFixed(2)},${distanceArray[i].toFixed(2)},${fuelArray[i].toFixed(3)}\n`;
    }
    
    downloadFile(csv, 'avtomobil_data.csv', 'text/csv');
  }
});

$('exportMatlab').addEventListener('click', () => {
  if (lastResult) {
    const code = generateMatlabCode(lastResult.params);
    downloadFile(code, 'avtomobil_analysis.m', 'text/plain');
  }
});

$('copyMatlabCode').addEventListener('click', () => {
  const code = $('currentMatlabCode').textContent;
  navigator.clipboard.writeText(code).then(() => {
    $('copyMatlabCode').textContent = '✅ Nusxalandi!';
    setTimeout(() => {
      $('copyMatlabCode').textContent = '📋 Kodni nusxalash';
    }, 2000);
  });
});

// Real-time parameter updates
['a', 'b', 'c', 'd', 'e', 'f', 'k'].forEach(id => {
  $(id).addEventListener('input', updateLabels);
});

// ========== TAB FUNCTIONALITY ==========
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    tab.classList.add('active');
    $('tab-' + tab.dataset.tab).classList.add('active');
  });
});

// ========== INITIALIZATION ==========
updateLabels();
runMain();

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
  stopAnimation();
});
</script>

</body>
</html>