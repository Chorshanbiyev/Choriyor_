<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MATLABda tenglama yechimi va uning grafiklari</title>

<!-- MathJax (formulalar) -->
<script>
  window.MathJax = { tex: { inlineMath: [['$','$'],['\\(','\\)']] } };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  :root{
    /* Oldingi (avvalgi) shablondagi ranglarga moslashtirildi */
    --bg1:#f0f8ff; --bg2:#f8fafc; --ink:#0f172a; --muted:#6b7280;
    --pri:#3b82f6; --pri2:#8b5cf6; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
    --card:#ffffff; --grid:#eef2f7; --frame:#e5e7eb; --accent:#06b6d4;
    --matlab:#ff6b35; --equation:#8b5cf6;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:'Segoe UI',Roboto,'San Francisco',Arial,sans-serif;color:var(--ink);
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    line-height:1.6;font-size:15px
  }
  .container{max-width:1600px;margin:0 auto;padding:20px}

  .header{
    background:var(--card);border-radius:20px;padding:35px;
    box-shadow:0 25px 50px rgba(0,0,0,.18);text-align:center;margin-bottom:24px;
    border:1px solid rgba(255,255,255,.35)
  }
  .header h1{
    margin:0 0 14px 0;font-size:34px;font-weight:800;
    background:linear-gradient(135deg,var(--pri),var(--matlab));-webkit-background-clip:text;
    -webkit-text-fill-color:transparent;background-clip:text
  }
  .header p{margin:0 0 6px 0;color:var(--muted);font-size:17px}
  .header .subtitle{color:var(--accent);font-weight:600;font-size:15px}

  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:24px}
  .grid3{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:18px}
  @media (max-width:1200px){.grid2{grid-template-columns:1fr}}

  .card{
    background:var(--card);border-radius:18px;padding:26px;
    box-shadow:0 15px 35px rgba(0,0,0,.12);margin-bottom:20px;border:1px solid rgba(255,255,255,.28)
  }
  .card h2{margin:0 0 18px 0;font-size:22px;font-weight:700;color:#1e293b}
  .card h3{margin:0 0 14px 0;font-size:19px;font-weight:600;color:#334155}
  .card h4{margin:0 0 10px 0;font-size:17px;font-weight:600;color:#475569}

  .problem-showcase{
    background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);
    border:3px solid var(--warn);border-radius:20px;padding:26px;margin:25px 0;position:relative
  }
  .problem-title{font-size:20px;font-weight:800;color:#92400e;margin-bottom:14px}
  .problem-scenario{
    background:rgba(255,255,255,.95);border-radius:12px;padding:18px;margin:14px 0;border-left:4px solid var(--warn)
  }

  .info-box{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);
            border-radius:12px;padding:16px;margin:12px 0}
  .warning-box{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.3);
               border-radius:12px;padding:16px;margin:12px 0}
  .success-box{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3);
               border-radius:12px;padding:16px;margin:12px 0}

  .equation-display{
    background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);
    border:3px solid var(--equation);border-radius:16px;padding:18px;margin:14px 0;text-align:center
  }
  .equation-text{font-size:18px;font-weight:700;color:var(--equation)}
  .equation-hint{color:var(--muted);font-size:14px;margin-top:6px}

  .control-panel{background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);
                 border:2px solid var(--frame);border-radius:16px;padding:20px;margin:16px 0}
  .control-group{margin-bottom:16px}
  .control-label{font-weight:600;color:#374151;margin-bottom:6px;display:block}
  .control-desc{color:var(--muted);font-size:13px;margin-bottom:8px}

  input[type=range]{width:100%;height:10px;border-radius:8px;background:#e5e7eb;
                   outline:none;-webkit-appearance:none;margin:8px 0;cursor:pointer}
  input[type=range]::-webkit-slider-thumb{
    appearance:none;width:22px;height:22px;border-radius:50%;background:var(--pri);
    cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,.25)
  }
  input[type=range]::-moz-range-thumb{
    width:22px;height:22px;border-radius:50%;background:var(--pri);cursor:pointer;border:none
  }
  input[type=number], select{
    padding:10px 12px;border:2px solid var(--frame);border-radius:10px;font-size:14px;background:#fff
  }
  input[type=number]:focus, select:focus{border-color:var(--pri);outline:none;box-shadow:0 0 0 3px rgba(59,130,246,.12)}

  .btn{
    background:var(--pri);border:0;color:#fff;padding:11px 16px;border-radius:12px;
    cursor:pointer;font-weight:600;transition:all .25s;display:inline-flex;align-items:center;gap:8px
  }
  .btn:hover{background:#2563eb;transform:translateY(-1px)}
  .btn.matlab{background:var(--matlab)}
  .btn.matlab:hover{background:#ea580c}
  .btn.outline{background:transparent;border:2px solid var(--pri);color:var(--pri)}
  .btn.outline:hover{background:var(--pri);color:#fff}
  .btn.success{background:var(--ok)}
  .btn.danger{background:var(--bad)}
  .btn-group{display:flex;gap:10px;flex-wrap:wrap;margin:14px 0}

  canvas{width:100%;height:480px;background:#fff;border:3px solid var(--frame);
         border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.08)}

  .tabs{
    display:flex;gap:6px;border-bottom:4px solid var(--frame);margin-bottom:18px;
    background:var(--bg2);border-radius:16px 16px 0 0;padding:10px 10px 0 10px
  }
  .tab{padding:12px 18px;cursor:pointer;border-radius:12px 12px 0 0;font-weight:600;transition:.25s}
  .tab:hover{background:rgba(59,130,246,.1)}
  .tab.active{background:var(--pri);color:#fff;box-shadow:0 4px 12px rgba(59,130,246,.25)}
  .tab-content{display:none;animation:fade .35s ease}
  .tab-content.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

  .code-block{background:#0f172a;color:#e2e8f0;border-radius:14px;padding:18px;
              border-left:6px solid var(--matlab);font-family:'Courier New',monospace;font-size:14px;overflow-x:auto}

  .results-panel{background:linear-gradient(135deg,#fff7ed 0%,#fed7aa 100%);
                 border:2px solid var(--matlab);border-radius:16px;padding:16px;margin:16px 0}
  .result-item{background:rgba(255,255,255,.95);border-radius:10px;padding:12px;margin:8px 0;
               display:flex;align-items:center;gap:10px}
  .result-label{font-weight:700;color:#9a3412;min-width:120px}
  .result-value{font-family:'Courier New',monospace;background:#0f172a;color:#e2e8f0;
                padding:8px 10px;border-radius:8px;flex:1}

  /* Savollar/Topshiriqlar */
  .qa-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:14px}
  .qa-card{background:var(--card);border:2px solid var(--frame);border-radius:14px;padding:16px}
  .qa-card h4{margin:0 0 8px 0}
  .bullet{margin:0 0 0 18px}
  @media (max-width:768px){canvas{height:380px}}
</style>
</head>
<body>
<div class="container">

  <!-- SARLAVHA -->
  <div class="header">
    <h1>üìä MATLABda tenglama yechimi va uning grafiklari</h1>
    <p>Murakkab tenglamalarni yechish, vizual tahlil qilish va MATLAB kodi bilan ishlash</p>
    <div class="subtitle">Interaktiv o‚Äòrganish ‚Ä¢ MATLAB dasturlash ‚Ä¢ Matematik modeling</div>
  </div>

  <!-- AMALIY MASALA TAQDIMOTI (mavzudan keyin qo‚Äòyildi) -->
  <div class="problem-showcase">
    <div class="problem-title">üè≠ Reaktor haroratini boshqarish</div>
    <div class="problem-scenario">
      <h4>üìù Masala qo‚Äòyilishi:</h4>
      <p>
        Reaktorda harorat vaqt o‚Äòtishi bilan ikki omil tufayli o‚Äòzgaradi:
        <strong>1)</strong> dastlab baland bo‚Äòlib asta-sekin pasayadi (eksponensial so‚Äònish),
        <strong>2)</strong> texnologik sikllar yoki tashqi tebranishlar tufayli davriy ‚Äúko‚Äòtarilib-tushadi‚Äù (sinus).
      </p>
      <p><strong>Model:</strong> $T(t) = a e^{-bt} + c\sin(dt) + T_0$</p>
      <ul class="bullet">
        <li><em>$a$</em> ‚Äî boshlang‚Äòich qo‚Äòshimcha issiqlik miqdori (qancha katta bo‚Äòlsa, startda shuncha ‚Äúqizigan‚Äù bo‚Äòladi)</li>
        <li><em>$b$</em> ‚Äî so‚Äònish tezligi (qanchalik katta bo‚Äòlsa, shuncha tez soviydi)</li>
        <li><em>$c$</em> ‚Äî tebranish amplitudasi (tebranish ‚Äúbalandligi‚Äù)</li>
        <li><em>$d$</em> ‚Äî tebranish chastotasi (tebranish ‚Äútezligi‚Äù, rad/soat)</li>
        <li><em>$T_0$</em> ‚Äî bazaviy harorat (uzoq muddatda yaqinlashadigan nuqta)</li>
      </ul>
      <p><strong>Maqsad:</strong> qaysi vaqtlarda harorat 300‚Äì400¬∞C oralig‚Äòida bo‚Äòlishini, maksimal-minimal nuqtalarni va qulay parametrlarni topish.</p>
    </div>
    <div class="warning-box"><strong>Nega muhim?</strong> Xavfsiz zona tashqarisiga chiqish portlash xavfi va sifat yomonlashuviga olib kelishi mumkin. Model bilan tezda tahlil qilish va qaror qabul qilish mumkin.</div>
  </div>

  <!-- ASOSIY SIMULYATOR -->
  <div class="card">
    <h2>üñ•Ô∏è Tizim strukturasi</h2>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="simulator">üéÆ Simulyator</div>
      <div class="tab" data-tab="methods">üß† Nazariya & usullar</div>
      <div class="tab" data-tab="matlab">üíª MATLAB kodlari</div>
      <div class="tab" data-tab="qa">üìù Savollar & topshiriqlar</div>
    </div>

    <!-- SIMULYATOR TABI -->
    <div class="tab-content active" id="tab-simulator">
      <div class="grid2">
        <div>
          <div class="control-panel">
            <h3>üéõÔ∏è Parametrlarni sozlash</h3>

            <div class="equation-display">
              <div class="equation-text">T(t) = a¬∑e<sup>‚àíb¬∑t</sup> + c¬∑sin(d¬∑t) + T‚ÇÄ</div>
              <div class="equation-hint">
                <strong>Tavsifi:</strong> ‚ÄúDastlab issiq (a) bo‚Äòlib, sekin-asta soviydi (b),
                shu paytda davriy tebranib turadi (c va d), barqaror nuqta T‚ÇÄ atrofida yuradi.‚Äù
              </div>
            </div>

            <div class="control-group">
              <label class="control-label">a ‚Äî boshlang‚Äòich issiqlik (10‚Äì100): <span id="valA">50</span></label>
              <div class="control-desc">Startdagi ‚Äúqizish‚Äù darajasi, e<sup>‚àíb¬∑t</sup> oldidagi koeffitsient</div>
              <input id="paramA" type="range" min="10" max="100" step="5" value="50">
            </div>

            <div class="control-group">
              <label class="control-label">b ‚Äî so‚Äònish tezligi (0.1‚Äì2.0): <span id="valB">0.5</span></label>
              <div class="control-desc">Qancha katta bo‚Äòlsa, shuncha tez soviydi</div>
              <input id="paramB" type="range" min="0.1" max="2" step="0.1" value="0.5">
            </div>

            <div class="control-group">
              <label class="control-label">c ‚Äî tebranish balandligi (5‚Äì50): <span id="valC">20</span></label>
              <div class="control-desc">Sinus tebranish amplitudasi</div>
              <input id="paramC" type="range" min="5" max="50" step="5" value="20">
            </div>

            <div class="control-group">
              <label class="control-label">d ‚Äî tebranish chastotasi (0.5‚Äì5.0): <span id="valD">2</span></label>
              <div class="control-desc">Sinus tebranish tezligi (rad/soat)</div>
              <input id="paramD" type="range" min="0.5" max="5" step="0.5" value="2">
            </div>

            <div class="control-group">
              <label class="control-label">T‚ÇÄ ‚Äî bazaviy harorat (300‚Äì400¬∞C): <span id="valT0">350</span></label>
              <div class="control-desc">Uzoq muddatda yaqinlashadigan ‚Äúmaqsad‚Äù harorat</div>
              <input id="paramT0" type="range" min="300" max="400" step="10" value="350">
            </div>

            <div class="btn-group">
              <button class="btn" id="solveEquation">üßÆ Yechish</button>
              <button class="btn" id="findExtremes">üìà Ekstremum</button>
              <button class="btn outline" id="resetParams">üîÑ Tiklash</button>
            </div>

            <div class="btn-group">
              <button class="btn success" id="saveGraph">üì∏ Grafikni PNG yuklab olish</button>
              <button class="btn" id="exportCSV">üìä Ma‚Äôlumotlarni CSV</button>
              <a class="btn matlab" id="openMatlab" href="https://matlab.mathworks.com" target="_blank" rel="noopener noreferrer">üîó MATLAB Online</a>
            </div>

            <div class="info-box"><strong>Eslatma:</strong> Yashil soya ‚Äî 300‚Äì400¬∞C xavfsiz zona. Grafik ostida MAX/MIN nuqtalar belgilanadi.</div>
          </div>

          <div class="results-panel">
            <h4>üìã Natijalar</h4>
            <div class="result-item"><div class="result-label">Maksimal T:</div><div class="result-value" id="maxTemp">‚Äî</div></div>
            <div class="result-item"><div class="result-label">Minimal T:</div><div class="result-value" id="minTemp">‚Äî</div></div>
            <div class="result-item"><div class="result-label">Xavfsiz vaqt ulushi:</div><div class="result-value" id="safeTime">‚Äî</div></div>
            <div class="result-item"><div class="result-label">O‚Äòrtacha T:</div><div class="result-value" id="avgTemp">‚Äî</div></div>
          </div>
        </div>

        <div>
          <h3>üìà Reaktor harorat grafigi</h3>
          <canvas id="tempCanvas" width="800" height="480"></canvas>
        </div>
      </div>
    </div>

    <!-- NAZARIYA & USULLAR TABI -->
    <div class="tab-content" id="tab-methods">
      <h3>üß† Nazariya va yechish usullari (oddiy tilda)</h3>
      <div class="grid3">
        <div class="card">
          <h4>üìê Hosila va ekstremum</h4>
          <div class="info-box">
            <strong></strong> Hosila ‚Äî grafigingizning ‚Äúqiyaligi‚Äù. Hosila 0 bo‚Äòlsa, tepalik (maksimum) yoki vodiy (minimum) bo‚Äòlishi mumkin.
          </div>
          <div class="code-block">
dT/dt = ‚àía¬∑b¬∑e^(‚àíb¬∑t) + c¬∑d¬∑cos(d¬∑t)
d¬≤T/dt¬≤ = a¬∑b¬≤¬∑e^(‚àíb¬∑t) ‚àí c¬∑d¬≤¬∑sin(d¬∑t)
          </div>
          <div class="success-box">Ekstremumni topish: avval dT/dt = 0 yechiladi, so‚Äòng d¬≤T/dt¬≤ ga qarab MAX/MIN aniqlanadi.</div>
        </div>

        <div class="card">
          <h4>üî¢ Sonli yondashuv</h4>
          <div class="info-box">
            <strong></strong> Qiyin tenglamalarni aniq emas, balki yaqin qiymatlar bilan tez hisoblaymiz. Diskret nuqtalarda T(t) ni hisoblab, MAX/MIN qidiramiz.
          </div>
          <div class="code-block">
Nyuton: x_{k+1} = x_k ‚àí f(x_k)/f'(x_k)
Bo‚Äòluv: [L,R] oraliqda belgini almashtirish orqali ildiz izlash
          </div>
        </div>

        <div class="card">
          <h4>üìä Grafik usul</h4>
          <div class="info-box">
            <strong></strong> Grafiga qarab qaysi vaqtda yuqori va past ekanini ko‚Äòrasiz. Xavfsiz zonani soyab ko‚Äòrsatish intuitiv tahlil beradi.
          </div>
          <div class="code-block">
[maxVal, iMax] = max(Tvals)
[minVal, iMin] = min(Tvals)
t_max = t(iMax);  t_min = t(iMin)
          </div>
        </div>
      </div>
    </div>

    <!-- MATLAB KODLARI TABI -->
    <div class="tab-content" id="tab-matlab">
      <h3>üíª Joriy parametrlar uchun MATLAB kodi</h3>
      <div class="code-block" id="dynamicMatlabCode">Kod tayyorlanmoqda‚Ä¶</div>
      <div class="btn-group">
        <button class="btn matlab" id="copyMatlabCode">üìã Kodni nusxalash</button>
        <button class="btn" id="downloadMatlab">üíæ .m fayl sifatida saqlash</button>
        <a class="btn outline" href="https://matlab.mathworks.com" target="_blank" rel="noopener noreferrer">üîó MATLAB Online</a>
      </div>
      <div class="info-box"><strong>Qulaylik:</strong> Kodni MATLAB Online‚Äôda ochib darhol ishga tushiring.</div>
    </div>

    <!-- SAVOLLAR & TOPSHIRIQLAR TABI -->
    <div class="tab-content" id="tab-qa">
      <h3>üìù Savollar va topshiriqlar</h3>
      <div class="qa-grid">
        <div class="qa-card">
          <h4>‚ùì Nazariy savollar</h4>
          <ul class="bullet">
            <li>Hosila nolga teng bo‚Äòlishi nimani anglatadi?</li>
            <li>Nega xavfsiz zona 300‚Äì400¬∞C tanlangan bo‚Äòlishi mumkin?</li>
            <li>Modeldagi $a, b, c, d, T_0$ parametrlari fizik ma‚Äônoda nimalarni bildiradi?</li>
            <li>Diskret nuqta sonini oshirish natijaga qanday ta‚Äôsir qiladi?</li>
          </ul>
        </div>
        <div class="qa-card">
          <h4>üî¨ Amaliy topshiriqlar</h4>
          <ol class="bullet">
            <li>$a$ ni kamaytirib, xavfsiz zona ichidagi vaqt ulushini oshira olasizmi?</li>
            <li>$b$ ni 2.0 ga yaqinlashtiring ‚Äî sovish tezlashsa, MAX/MIN nuqtalar qayerga siljiydi?</li>
            <li>$c$ va $d$ ni o‚Äòzgartirib, ‚Äúeng sokin‚Äù (tebranishi kam) rejimni toping.</li>
            <li>Jadval/CSV eksport qilib, o‚Äòzingizning statistik tahlilingizni qiling.</li>
          </ol>
        </div>
      </div>
      <div class="success-box"><strong>Maslahat:</strong> Har bir topshiriqdan so‚Äòng grafikni PNG qilib saqlang va hisobotga qo‚Äòying.</div>
    </div>
  </div>

</div>

<!-- ===== JAVASCRIPT: SIMULYATOR LOGIKASI ===== -->
<script>
// ======== UTIL ========
function $(id){return document.getElementById(id);}
function downloadFile(content, filename, mimeType='text/plain'){
  const blob = new Blob([content], {type: mimeType + ';charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
}

// ======== STATE ========
let simState = { a:50, b:0.5, c:20, d:2, T0:350, t0:0, t1:10, n:1000 };

// ======== MODEL ========
function T(t,s=simState){ return s.a*Math.exp(-s.b*t) + s.c*Math.sin(s.d*t) + s.T0; }
function dT(t,s=simState){ return -s.a*s.b*Math.exp(-s.b*t) + s.c*s.d*Math.cos(s.d*t); }

function sample(){
  const dt=(simState.t1-simState.t0)/simState.n;
  const pts=[];
  for(let i=0;i<=simState.n;i++){
    const t=simState.t0+i*dt;
    pts.push({t, val:T(t)});
  }
  return pts;
}

function metrics(){
  const pts=sample();
  let max=pts[0], min=pts[0], safe=0;
  const SAFE_MIN=300, SAFE_MAX=400;
  for(const p of pts){
    if(p.val>max.val) max=p;
    if(p.val<min.val) min=p;
    if(p.val>=SAFE_MIN && p.val<=SAFE_MAX) safe++;
  }
  const avg=pts.reduce((s,p)=>s+p.val,0)/pts.length;
  return {
    max, min,
    safePct: 100*safe/pts.length,
    avg, pts
  };
}

// ======== CANVAS ========
function setupCanvas(){
  const canvas=$('tempCanvas');
  const ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  const rect=canvas.getBoundingClientRect();
  canvas.width=rect.width*dpr; canvas.height=rect.height*dpr; ctx.scale(dpr,dpr);
  return {canvas,ctx,w:rect.width,h:rect.height};
}
function clearCanvas(ctx,w,h){
  ctx.clearRect(0,0,w,h);
  // grid
  ctx.strokeStyle='#f1f5f9'; ctx.lineWidth=1;
  for(let x=60;x<w-40;x+=80){ctx.beginPath();ctx.moveTo(x,40);ctx.lineTo(x,h-60);ctx.stroke();}
  for(let y=40;y<h-60;y+=40){ctx.beginPath();ctx.moveTo(60,y);ctx.lineTo(w-40,y);ctx.stroke();}
  // axes
  ctx.strokeStyle='#64748b'; ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(60,h-60);ctx.lineTo(w-40,h-60);ctx.stroke();
  ctx.beginPath();ctx.moveTo(60,40);ctx.lineTo(60,h-60);ctx.stroke();
  // labels
  ctx.fillStyle='#374151'; ctx.font='14px Arial'; ctx.textAlign='center';
  for(let i=0;i<=10;i+=2){ const x=60+(i/10)*(w-100); ctx.fillText(`${i}h`,x,h-35); }
  ctx.textAlign='right';
  for(let T=250;T<=450;T+=50){
    const y=h-60 - ((T-250)/200)*(h-100);
    ctx.fillText(`${T}¬∞C`,55,y+5);
  }
  ctx.textAlign='center'; ctx.fillText('Vaqt (soat)', w/2, h-10);
  ctx.save(); ctx.translate(20,h/2); ctx.rotate(-Math.PI/2); ctx.fillText('Harorat (¬∞C)',0,0); ctx.restore();
}
function drawSafeZone(ctx,w,h){
  const SAFE_MIN=300, SAFE_MAX=400;
  const yMin=h-60 - ((SAFE_MIN-250)/200)*(h-100);
  const yMax=h-60 - ((SAFE_MAX-250)/200)*(h-100);
  ctx.fillStyle='rgba(16,185,129,0.15)';
  ctx.fillRect(60,yMax,w-100,yMin-yMax);
  ctx.strokeStyle='#10b981'; ctx.setLineDash([6,6]); ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(60,yMin);ctx.lineTo(w-40,yMin);ctx.stroke();
  ctx.beginPath();ctx.moveTo(60,yMax);ctx.lineTo(w-40,yMax);ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle='#059669'; ctx.font='12px Arial'; ctx.textAlign='left';
  ctx.fillText('Xavfsiz zona (300‚Äì400¬∞C)', w-220, yMax-8);
}
function drawCurve(ctx,w,h){
  const {pts,max,min}=metrics();
  ctx.strokeStyle='#3b82f6'; ctx.lineWidth=3; ctx.beginPath();
  pts.forEach((p,i)=>{
    const x=60 + (p.t/10)*(w-100);
    const y=h-60 - ((p.val-250)/200)*(h-100);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();
  // mark max/min
  const px=(t)=>60+(t/10)*(w-100), py=(v)=>h-60 - ((v-250)/200)*(h-100);
  ctx.fillStyle='#ef4444'; ctx.beginPath(); ctx.arc(px(max.t),py(max.val),6,0,2*Math.PI); ctx.fill();
  ctx.fillStyle='#1d4ed8'; ctx.beginPath(); ctx.arc(px(min.t),py(min.val),6,0,2*Math.PI); ctx.fill();
  ctx.fillStyle='#0f172a'; ctx.font='12px Arial'; ctx.textAlign='center';
  ctx.fillText('MAX', px(max.t), py(max.val)-12);
  ctx.fillText('MIN', px(min.t), py(min.val)-12);
}
function redraw(){
  const {ctx,w,h}=setupCanvas();
  clearCanvas(ctx,w,h);
  drawSafeZone(ctx,w,h);
  drawCurve(ctx,w,h);
}

// ======== UI ========
function updateUI(){
  $('valA').textContent=simState.a;
  $('valB').textContent=simState.b.toFixed(1);
  $('valC').textContent=simState.c;
  $('valD').textContent=simState.d.toFixed(1);
  $('valT0').textContent=simState.T0;

  const m=metrics();
  $('maxTemp').textContent = `${m.max.val.toFixed(1)}¬∞C (t=${m.max.t.toFixed(2)} h)`;
  $('minTemp').textContent = `${m.min.val.toFixed(1)}¬∞C (t=${m.min.t.toFixed(2)} h)`;
  $('safeTime').textContent = `${m.safePct.toFixed(1)}%`;
  $('avgTemp').textContent = `${m.avg.toFixed(1)}¬∞C`;
}

function matlabCode(){
  const s=simState;
  return `% Reaktor harorat modellashtirish (joriy parametrlar)
clear; clc;
a=${s.a}; b=${s.b}; c=${s.c}; d=${s.d}; T0=${s.T0};
T = @(t) a*exp(-b*t) + c*sin(d*t) + T0;
t = linspace(0,10,1000);
temperature = T(t);

% Xavfsiz zona
Tmin=300; Tmax=400;

% Ekstremumlar (grafikdan)
[maxT,iMax] = max(temperature);
[minT,iMin] = min(temperature);
tMax = t(iMax); tMin = t(iMin);

figure('Name','Reaktor tahlili','Position',[100 100 900 650]);
subplot(2,2,1);
plot(t,temperature,'b-','LineWidth',2); hold on;
yline(Tmin,'r--','Min xavfsiz','LineWidth',1.5);
yline(Tmax,'r--','Max xavfsiz','LineWidth',1.5);
fill([t fliplr(t)],[Tmin*ones(size(t)) Tmax*ones(size(t))],...
     'g','FaceAlpha',.15,'EdgeColor','none');
plot(tMax,maxT,'ro','MarkerFaceColor','r'); plot(tMin,minT,'bo','MarkerFaceColor','b');
grid on; xlabel('Vaqt (soat)'); ylabel('Harorat (¬∞C)');
title('Harorat va xavfsiz zona'); legend('T(t)','Zona','Location','best');

subplot(2,2,2);
histogram(temperature,30); title('Harorat taqsimoti'); grid on;

subplot(2,2,3);
dt = t(2)-t(1);
plot(t(1:end-1), diff(temperature)/dt, 'm','LineWidth',1.5);
grid on; xlabel('Vaqt'); ylabel('dT/dt'); title('O\\''zgarish tezligi');

subplot(2,2,4);
safe = (temperature>=Tmin) & (temperature<=Tmax);
area(t, safe, 'FaceColor',[.2 .8 .4],'FaceAlpha',.3);
ylim([-0.1 1.1]); grid on; xlabel('Vaqt'); ylabel('Xavfsiz (1)/Yo\\''q (0)');
title('Xavfsizlik indikatori');

fprintf('MAX: %.2f¬∞C (t=%.2f h)\\n', maxT, tMax);
fprintf('MIN: %.2f¬∞C (t=%.2f h)\\n', minT, tMin);
fprintf('O\\''rtacha: %.2f¬∞C\\n', mean(temperature));
fprintf('Xavfsiz ulush: %.1f%%\\n', 100*mean(safe));

saveas(gcf,'reaktor_grafik.png');
csvwrite('reaktor_data.csv',[t(:) temperature(:)]);
`;
}

function updateCodeBlock(){
  $('dynamicMatlabCode').textContent = matlabCode();
}

// ======== EVENTS ========
function bind(){
  $('paramA').addEventListener('input',e=>{simState.a=parseInt(e.target.value); redraw(); updateUI(); updateCodeBlock();});
  $('paramB').addEventListener('input',e=>{simState.b=parseFloat(e.target.value); redraw(); updateUI(); updateCodeBlock();});
  $('paramC').addEventListener('input',e=>{simState.c=parseInt(e.target.value); redraw(); updateUI(); updateCodeBlock();});
  $('paramD').addEventListener('input',e=>{simState.d=parseFloat(e.target.value); redraw(); updateUI(); updateCodeBlock();});
  $('paramT0').addEventListener('input',e=>{simState.T0=parseInt(e.target.value); redraw(); updateUI(); updateCodeBlock();});

  $('solveEquation').addEventListener('click',()=>{
    redraw(); updateUI();
    $('solveEquation').textContent='‚úÖ Yechildi'; setTimeout(()=>{$('solveEquation').textContent='üßÆ Yechish';},1200);
  });

  $('findExtremes').addEventListener('click',()=>{
    const m=metrics();
    alert(`Ekstremumlar:\n\nMAX = ${m.max.val.toFixed(2)} ¬∞C (t=${m.max.t.toFixed(2)} h)\nMIN = ${m.min.val.toFixed(2)} ¬∞C (t=${m.min.t.toFixed(2)} h)`);
  });

  $('resetParams').addEventListener('click',()=>{
    simState={a:50,b:0.5,c:20,d:2,T0:350,t0:0,t1:10,n:1000};
    ['paramA','paramB','paramC','paramD','paramT0'].forEach((id,i)=>{
      const v=[50,0.5,20,2,350][i]; $(id).value=v;
    });
    redraw(); updateUI(); updateCodeBlock();
  });

  $('saveGraph').addEventListener('click',()=>{
    const canvas=$('tempCanvas');
    const link=document.createElement('a');
    link.download='reaktor_harorat_grafik.png';
    link.href=canvas.toDataURL('image/png');
    link.click();
  });

  $('exportCSV').addEventListener('click',()=>{
    const {pts}=metrics();
    let csv='t,Temperature\n';
    for(const p of pts) csv+=`${p.t.toFixed(4)},${p.val.toFixed(6)}\n`;
    downloadFile(csv,'reaktor_data.csv','text/csv');
  });

  $('copyMatlabCode').addEventListener('click',()=>{
    const code=matlabCode();
    navigator.clipboard.writeText(code).then(()=>{
      $('copyMatlabCode').textContent='‚úÖ Nusxalandi';
      setTimeout(()=>{$('copyMatlabCode').textContent='üìã Kodni nusxalash';},1200);
    });
  });

  $('downloadMatlab').addEventListener('click',()=>{
    downloadFile(matlabCode(),'reaktor_model.m','text/plain');
  });

  // Tabs
  document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      tab.classList.add('active');
      $('tab-'+tab.dataset.tab).classList.add('active');
    });
  });
}

// ======== INIT ========
function init(){
  bind();
  redraw();
  updateUI();
  updateCodeBlock();
}
document.addEventListener('DOMContentLoaded', init);
window.addEventListener('resize', redraw);
</script>

</body>
</html>
